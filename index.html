<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HIIT é–“æ­‡è¨“ç·´è¨ˆæ™‚å™¨</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #222;
            color: white;
            transition: background-color 0.3s;
            overflow: hidden; /* é˜²æ­¢æ•´é«”é é¢æ²å‹• */
        }

        /* è¨­å®šé é¢æ¨£å¼ */
        #setup-screen {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100%;
            overflow-y: auto; /* å…è¨±è¨­å®šé å…§å®¹æ²å‹• */
        }
        .input-group {
            background: #333;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .input-group label {
            display: block;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #ccc;
            font-weight: bold;
        }
        .time-inputs {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        input[type="number"] {
            width: 100%;
            padding: 10px;
            font-size: 1.2rem;
            border: none;
            background: #444;
            color: white;
            border-radius: 8px;
            text-align: center;
            -moz-appearance: textfield; /* Firefox ç§»é™¤ç®­é ­ */
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none; /* Chrome/Safari ç§»é™¤ç®­é ­ */
            margin: 0;
        }

        .unit { font-size: 0.9rem; color: #888; white-space: nowrap; }
        
        #total-display {
            text-align: center;
            font-size: 1.2rem;
            margin-top: 10px;
            color: #4cd964;
            font-weight: bold;
            padding-bottom: 20px;
        }

        /* é‹å‹•é é¢æ¨£å¼ */
        #timer-screen {
            display: none; /* é è¨­éš±è— */
            height: 100%;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            text-align: center;
            padding: 20px;
        }
        #status-text { font-size: 2.5rem; font-weight: bold; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        #main-timer { font-size: 22vw; /* è‡ªé©æ‡‰å­—é«”å¤§å° */ font-weight: bold; font-variant-numeric: tabular-nums; line-height: 1; margin: 10px 0; }
        @media (min-width: 600px) { #main-timer { font-size: 8rem; } }
        
        #sub-info { font-size: 1.5rem; margin-top: 5px; opacity: 0.9; font-weight: 500;}
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            width: 100%;
            padding: 18px;
            font-size: 1.3rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.1s;
            -webkit-user-select: none;
            user-select: none;
        }
        .btn:active { transform: scale(0.96); }
        .btn-start { background: #007aff; color: white; margin-bottom: 30px; }
        
        /* æš«åœæŒ‰éˆ• (å›ºå®šåº•éƒ¨) */
        #btn-pause { 
            position: absolute; bottom: 40px; width: 80%; 
            background: rgba(255,255,255,0.2); border: 2px solid white; color: white;
            backdrop-filter: blur(5px);
        }

        /* çµæŸæ™‚çš„æŒ‰éˆ• (åŸæœ¬éš±è—) */
        #btn-home {
            display: none;
            background: white; 
            color: #2980b9; 
            width: 80%;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: popIn 0.5s ease-out;
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* æš«åœé¸å–® */
        #pause-overlay {
            display: none;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            z-index: 10;
            backdrop-filter: blur(5px);
        }
        .btn-resume { background: #34c759; color: white; width: 80%; }
        .btn-stop { background: #ff3b30; color: white; width: 80%; }

        /* èƒŒæ™¯é¡è‰²é¡åˆ¥ */
        .bg-setup { background-color: #222; }
        .bg-warmup { background-color: #27ae60; } /* ç¶ è‰² */
        .bg-work { background-color: #c0392b; }   /* ç´…è‰² */
        .bg-rest { background-color: #27ae60; }   /* ç¶ è‰² */
        .bg-finished { background-color: #2980b9; } /* è—è‰² */
    </style>
</head>
<body>

<div id="setup-screen">
    <h2 style="text-align:center; margin-bottom: 5px;">é–“æ­‡è¨“ç·´è¨­å®š</h2>
    <div class="input-group">
        <label>1. ç†±èº«æ™‚é–“ (æº–å‚™)</label>
        <div class="time-inputs">
            <input type="number" id="warmMin" value="1" min="0" oninput="calcTotal()"> <span class="unit">åˆ†</span>
            <input type="number" id="warmSec" value="0" min="0" max="59" oninput="calcTotal()"> <span class="unit">ç§’</span>
        </div>
    </div>

    <div class="input-group">
        <label style="color: #ff5e57;">2. é‹å‹•/è¡åˆºæ™‚é–“ (ç´…)</label>
        <div class="time-inputs">
            <input type="number" id="workMin" value="1" min="0" oninput="calcTotal()"> <span class="unit">åˆ†</span>
            <input type="number" id="workSec" value="0" min="0" max="59" oninput="calcTotal()"> <span class="unit">ç§’</span>
        </div>
    </div>

    <div class="input-group">
        <label style="color: #2ecc71;">3. ç·©å’Œ/ä¼‘æ¯æ™‚é–“ (ç¶ )</label>
        <div class="time-inputs">
            <input type="number" id="restMin" value="1" min="0" oninput="calcTotal()"> <span class="unit">åˆ†</span>
            <input type="number" id="restSec" value="0" min="0" max="59" oninput="calcTotal()"> <span class="unit">ç§’</span>
        </div>
    </div>

    <div class="input-group">
        <label>4. è¼ªæ¬¡ (è¡åˆº+ç·©å’Œç®—1è¼ª)</label>
        <div class="time-inputs">
            <input type="number" id="rounds" value="10" min="1" oninput="calcTotal()"> <span class="unit">æ¬¡</span>
        </div>
    </div>

    <div id="total-display">é ä¼°ç¸½é•·åº¦: 21:00</div>
    <button class="btn btn-start" onclick="startWorkout()">é–‹å§‹è¨“ç·´</button>
</div>

<div id="timer-screen">
    <div id="status-text">ç†±èº«</div>
    <div id="main-timer">00:00</div>
    <div id="sub-info">æº–å‚™é–‹å§‹</div>
    
    <button id="btn-pause" class="btn" onclick="pauseWorkout()">æš« åœ</button>
    <button id="btn-home" class="btn" onclick="stopWorkout()">å›åˆ°è¨­å®šé é¢</button>

    <div id="pause-overlay">
        <h2 style="font-size: 2rem; margin-bottom: 20px;">å·²æš«åœ</h2>
        <button class="btn btn-resume" onclick="resumeWorkout()">ç¹¼çºŒ</button>
        <button class="btn btn-stop" onclick="stopWorkout()">çµæŸè¨“ç·´</button>
    </div>
</div>

<script>
    let intervalTimer = null;
    let currentPhase = 'warmup'; 
    let currentRound = 1;
    let maxRounds = 10;
    let phaseTimeLeft = 0;
    let cfg = {};
    // åˆå§‹åŒ– AudioContext
    let audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    calcTotal();

    function calcTotal() {
        const wm = parseInt(document.getElementById('warmMin').value) || 0;
        const ws = parseInt(document.getElementById('warmSec').value) || 0;
        const km = parseInt(document.getElementById('workMin').value) || 0;
        const ks = parseInt(document.getElementById('workSec').value) || 0;
        const rm = parseInt(document.getElementById('restMin').value) || 0;
        const rs = parseInt(document.getElementById('restSec').value) || 0;
        const r = parseInt(document.getElementById('rounds').value) || 1;
        
        // ç†±èº« + (é‹å‹•+ä¼‘æ¯)*è¼ªæ•¸
        const total = (wm*60+ws) + ((km*60+ks)+(rm*60+rs))*r;
        document.getElementById('total-display').innerText = `é ä¼°ç¸½é•·åº¦: ${formatTime(total)}`;
    }

    function formatTime(sec) {
        if (sec < 0) sec = 0; 
        let m = Math.floor(sec / 60);
        let s = sec % 60;
        return `${m}:${s < 10 ? '0' : ''}${s}`;
    }

    // æ’­æ”¾æç¤ºéŸ³
    function playBeep(type) {
        // ç¢ºä¿ AudioContext è™•æ–¼é‹è¡Œç‹€æ…‹ (ç€è¦½å™¨æ”¿ç­–é™åˆ¶)
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }

        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        const now = audioCtx.currentTime;

        if (type === 'high') { 
            // é‹å‹•é–‹å§‹ï¼šé«˜éŸ³
            osc.frequency.setValueAtTime(880, now); 
            osc.type = 'square';
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.6);
            osc.start(now); 
            osc.stop(now + 0.6);
        } else if (type === 'low') { 
            // ä¼‘æ¯/ç†±èº«ï¼šä½éŸ³
            osc.frequency.setValueAtTime(440, now);
            osc.type = 'sine';
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.4);
            osc.start(now); 
            osc.stop(now + 0.4);
        } else if (type === 'end') { 
            // çµæŸéŸ³æ•ˆï¼šä¸‰è²
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(523.25, now); // Do
            gain.gain.setValueAtTime(0.1, now);
            osc.start(now); 
            osc.stop(now + 0.2);

            const osc2 = audioCtx.createOscillator();
            const gain2 = audioCtx.createGain();
            osc2.connect(gain2); gain2.connect(audioCtx.destination);
            osc2.type = 'triangle';
            osc2.frequency.setValueAtTime(659.25, now + 0.25); // Mi
            gain2.gain.setValueAtTime(0.1, now + 0.25);
            osc2.start(now + 0.25); osc2.stop(now + 0.45);

            const osc3 = audioCtx.createOscillator();
            const gain3 = audioCtx.createGain();
            osc3.connect(gain3); gain3.connect(audioCtx.destination);
            osc3.type = 'triangle';
            osc3.frequency.setValueAtTime(783.99, now + 0.5); // Sol
            gain3.gain.setValueAtTime(0.1, now + 0.5);
            gain3.gain.exponentialRampToValueAtTime(0.001, now + 1.5);
            osc3.start(now + 0.5); osc3.stop(now + 1.5);
        }
    }

    function startWorkout() {
        // è®€å–è¨­å®š
        cfg = {
            warm: (parseInt(document.getElementById('warmMin').value)||0)*60 + (parseInt(document.getElementById('warmSec').value)||0),
            work: (parseInt(document.getElementById('workMin').value)||0)*60 + (parseInt(document.getElementById('workSec').value)||0),
            rest: (parseInt(document.getElementById('restMin').value)||0)*60 + (parseInt(document.getElementById('restSec').value)||0),
            rounds: parseInt(document.getElementById('rounds').value)||1
        };

        // UI åˆ‡æ›
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('timer-screen').style.display = 'flex';
        document.getElementById('pause-overlay').style.display = 'none';
        
        document.getElementById('btn-pause').style.display = 'block';
        document.getElementById('btn-home').style.display = 'none';
        
        currentRound = 1;
        maxRounds = cfg.rounds;
        
        // å–šé†’éŸ³æ•ˆå¼•æ“
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }

        // æ±ºå®šåˆå§‹éšæ®µ
        if (cfg.warm > 0) {
            setPhase('warmup');
            playBeep('low');
        } else {
            setPhase('work');
            // å¦‚æœæ²’æœ‰ç†±èº«ç›´æ¥é–‹å§‹ï¼Œé€™è£¡æœƒåœ¨ setPhase è£¡ç™¼è²
        }

        intervalTimer = setInterval(tick, 1000);
    }

    function setPhase(phase) {
        currentPhase = phase;
        if (phase === 'warmup') {
            phaseTimeLeft = cfg.warm;
            updateUI('ç†±èº«æ™‚é–“', 'bg-warmup', `æº–å‚™é€²å…¥ç¬¬ 1 è¼ª`);
        } else if (phase === 'work') {
            phaseTimeLeft = cfg.work;
            updateUI('ğŸ”¥ å…¨åŠ›è¡åˆº', 'bg-work', `ç¬¬ ${currentRound} / ${maxRounds} è¼ª`);
            playBeep('high');
        } else if (phase === 'rest') {
            phaseTimeLeft = cfg.rest;
            updateUI('ğŸ˜Œ ç·©å’Œä¼‘æ¯', 'bg-rest', `ç¬¬ ${currentRound} è¼ªå®Œæˆ`);
            playBeep('low');
        } else if (phase === 'finished') {
            clearInterval(intervalTimer);
            phaseTimeLeft = 0;
            document.getElementById('main-timer').innerText = "00:00";
            updateUI('ğŸ‰ è¨“ç·´çµæŸ', 'bg-finished', 'å¤ªå²å®³äº†ï¼å®Œæˆé€™æ¬¡è¨“ç·´');
            document.getElementById('btn-pause').style.display = 'none';
            document.getElementById('btn-home').style.display = 'block';
            playBeep('end');
        }
        
        if (phase !== 'finished') {
            document.getElementById('main-timer').innerText = formatTime(phaseTimeLeft);
        }
    }

    function updateUI(status, bgClass, subInfo) {
        document.getElementById('status-text').innerText = status;
        document.body.className = bgClass;
        document.getElementById('sub-info').innerText = subInfo;
    }

    function tick() {
        if (phaseTimeLeft > 0) {
            phaseTimeLeft--;
            document.getElementById('main-timer').innerText = formatTime(phaseTimeLeft);
        } else {
            nextPhase();
        }
    }

    function nextPhase() {
        if (currentPhase === 'warmup') {
            setPhase('work');
        } else if (currentPhase === 'work') {
            // å¦‚æœæ˜¯æœ€å¾Œä¸€è¼ªä¸”ä¸éœ€è¦æœ€å¾Œä¼‘æ¯ï¼Œå¯ä»¥ç›´æ¥çµæŸ (æ­¤è™•é‚è¼¯è¨­å®šç‚ºä¸€å®šæœ‰ä¼‘æ¯)
            setPhase('rest');
        } else if (currentPhase === 'rest') {
            if (currentRound < maxRounds) {
                currentRound++;
                setPhase('work');
            } else {
                setPhase('finished');
            }
        }
    }

    function pauseWorkout() {
        clearInterval(intervalTimer);
        document.getElementById('pause-overlay').style.display = 'flex';
    }

    function resumeWorkout() {
        document.getElementById('pause-overlay').style.display = 'none';
        intervalTimer = setInterval(tick, 1000);
        if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    function stopWorkout() {
        clearInterval(intervalTimer);
        document.getElementById('timer-screen').style.display = 'none';
        document.getElementById('setup-screen').style.display = 'flex';
        document.body.className = 'bg-setup';
    }
</script>

</body>
</html>